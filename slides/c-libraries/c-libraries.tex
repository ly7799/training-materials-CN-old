\begin{frame}
  \frametitle{glibc}
  \begin{columns}
    \column{0.7\textwidth}
    \begin{itemize}
    \item License: LGPL
    \item C library from the GNU project
    \item Designed for performance, standards compliance and portability
    \item Found on all GNU / Linux host systems
    \item Of course, actively maintained
    \item By default, quite big for small embedded systems.
      On armv7hf, version 2.23: \code{libc}: 1.5 MB, \code{libm}: 492
      KB, source: \url{https://toolchains.bootlin.com}
    \item But some features not needed in embedded systems can be
          configured out (merged from the old {\em eglibc} project).
    \item \url{https://www.gnu.org/software/libc/}
    \end{itemize}
    \vfill
    \column{0.3\textwidth}
    \minipage[c][0.8\textheight][s]{\columnwidth}
    \includegraphics[width=\textwidth]{slides/c-libraries/heckert_gnu_white.pdf}
    \vfill
    \tiny Image: \url{https://bit.ly/2EzHl6m}
    \endminipage
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{uClibc-ng}
  \begin{itemize}
  \item \url{https://uclibc-ng.org/}
  \item A continuation of the old uClibc project, license: LGPL
  \item Lightweight C library for small embedded systems
    \begin{itemize}
    \item High configurability: many features can be enabled or
      disabled through a menuconfig interface.
    \item Supports most embedded architectures, including MMU-less
          ones (ARM Cortex-M, Blackfin, etc.). The only library
          supporting ARM noMMU.
    \item No guaranteed binary compatibility. May need to
      recompile applications when the library configuration changes.
    \item Some glibc features may not be implemented yet (real-time,
          floating-point operations...)
    \item Focus on size rather than performance
    \item Size on armv7hf, version 1.0.24:
      \code{libc}: 652 KB, source: \url{https://toolchains.bootlin.com}
    \end{itemize}
    \item Actively supported, but Yocto Project stopped supporting it.
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{musl C library}
  \begin{columns}
    \column{0.85\textwidth}
      \url{https://www.musl-libc.org/}
      \begin{itemize}
      \item A lightweight, fast and simple library for embedded systems
      \item Created while uClibc's development was stalled
      \item In particular, great at making small static executables
      \item More permissive license (MIT), making it easier to release
            static executables. We will talk about the requirements
            of the LGPL license (glibc, uClibc) later.
      \item Supported by build systems such as Buildroot and Yocto
        Project.
      \item Used by the Alpine Linux distribution
        (\url{https://www.alpinelinux.org/}), fitting in about 130 MB of storage.
      \end{itemize}
    \column{0.15\textwidth}
    \includegraphics[width=\textwidth]{slides/c-libraries/musl.png}
  \end{columns}
\end{frame}

\begin{frame}{glibc vs uclibc-ng vs musl - small static executables}
  Let's compile and strip a \code{hello.c} program {\bf statically} and
compare the size
  \begin{itemize}
    \item With gcc 6.3, armel, musl 1.1.16:\\
          {\bf 7300} bytes
    \item With gcc 6.3, armel, uclibc-ng 1.0.22 :\\
          {\bf 67204} bytes.
    \item With gcc 6.2, armel, glibc:\\
          {\bf 492792} bytes
  \end{itemize}
\end{frame}

\begin{frame}{glibc vs uclibc vs musl (static)}
  Let's compile and strip BusyBox 1.26.2 {\bf statically} and compare the size
  \begin{itemize}
    \item With gcc 6.3, armel, musl 1.1.16:\\
          {\bf 183348} bytes
    \item With gcc 6.3, armel, uclibc-ng 1.0.22 :\\
          {\bf 210620} bytes.\\
    \item With gcc 6.2, armel, glibc:\\
          {\bf 755088} bytes
  \end{itemize}
  Notes:
  \begin{itemize}
    \item BusyBox is automatically compiled with \code{-Os} and stripped.
    \item Compiling with shared libraries will mostly eliminate size differences
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Other smaller C libraries}
  \begin{itemize}
  \item Several other smaller C libraries have been developed, but
    none of them have the goal of allowing the compilation of large
    existing applications
  \item They can run only relatively simple programs,
	typically to make very small static executables and run
	in very small root filesystems.
  \item Choices:
    \begin{itemize}
    \item Newlib, \url{https://sourceware.org/newlib/}
    \item Klibc, \url{https://kernel.org/pub/linux/libs/klibc/},
      designed for use in an {\em initramfs} or {\em initrd} at boot
      time.
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Advise for choosing the C library}
  \begin{itemize}
  \item Advice to start developing and debugging your applications with
        {\em glibc}, which is the most standard solution.
  \item Then, when everything works, if you have size constraints, try to compile
        your app and then the entire filesystem with {\em uClibc} or {\em musl}.
  \item If you run into trouble, it could be because of missing features
        in the C library.
  \item In case you wish to make static executables, {\em musl} will be
        an easier choice. Note that static executables built with a given C library
        can be used in a system with a different C library.
  \end{itemize}
\end{frame}
